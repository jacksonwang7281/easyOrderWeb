@page "{restaurantId}"
@model WebApplication1.Pages.OrderModel
@{
    ViewData["Title"] = "點餐計數器";
}

<h1>點餐計數器 - @Model.RestaurantId</h1>

<form method="post">
    <div>
        <button type="button" id="minusBtn">-</button>
        <span id="counterDisplay">0</span>
        <button type="button" id="plusBtn">+</button>
    </div>

    <input type="hidden" id="counter" name="counter" value="0" />
    <input type="hidden" name="restaurantId" value="@Model.RestaurantId" />

    <br />
    <button type="submit">送出</button>

    <p><a href="/Kitchen/@Model.RestaurantId">前往廚房頁面</a></p>
</form>

@if (Model.Submitted)
{
    <p style="color: green;">你送出了數量：@Model.Counter</p>
}

<script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/7.0.5/signalr.min.js"></script>
<script>
    const connection = new signalR.HubConnectionBuilder()
        .withUrl("/orderHub")
        .build();

    connection.start().then(() => {
        console.log("SignalR connected");
    });

    document.querySelector("form").addEventListener("submit", function () {
        connection.invoke("SendAsync", "NewOrder_@Model.RestaurantId");
    });

    let counter = 0;
    const min = 0;
    const max = 10;

    const counterDisplay = document.getElementById("counterDisplay");
    const hiddenInput = document.getElementById("counter");

    document.getElementById("plusBtn").addEventListener("click", () => {
        if (counter < max) {
            counter++;
            counterDisplay.textContent = counter;
            hiddenInput.value = counter;
        }
    });

    document.getElementById("minusBtn").addEventListener("click", () => {
        if (counter > min) {
            counter--;
            counterDisplay.textContent = counter;
            hiddenInput.value = counter;
        }
    });
</script>