@page "{restaurantId}"
@model WebApplication1.Pages.KitchenModel
@{
    ViewData["Title"] = "廚房訂單";
}

<h1>目前收到的訂單 - @Model.RestaurantId</h1>

@if (Model.Orders.Count == 0)
{
    <p>目前沒有訂單。</p>
}
else
{
    <div style="display: flex; flex-direction: column; gap: 20px;">
        @foreach (var order in Model.Orders.OrderByDescending(o => o.Timestamp))
        {
            <div style="border: 2px solid #444; padding: 15px; border-radius: 10px; background-color: #f9f9f9;">
                <strong>訂單時間：</strong>@order.Timestamp.ToString("HH:mm:ss")<br />
                <strong>內容：</strong>
                <ul style="margin-top: 8px;">
                    @foreach (var item in order.Items)
                    {
                        <li>@item.Key x @item.Value</li>
                    }
                </ul>
            </div>
        }
    </div>
}

<a href="/Order?restaurantId=@Model.RestaurantId">返回點餐頁面</a>

<script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/7.0.5/signalr.min.js"></script>
<script>
    const connection = new signalR.HubConnectionBuilder()
        .withUrl("/orderHub")
        .build();

    connection.start().then(() => {
        console.log("Kitchen connected");
    });

    connection.on("NewOrder_@Model.RestaurantId", () => {
        location.reload();
    });
</script>
